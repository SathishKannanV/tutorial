<?xml version="1.0"?>

<project name="aefw-server-setup" default="main" basedir=".">
	
	<!-- ================================================================ -->
	<!-- M A I N                                                          -->
	<!-- ================================================================ -->

	<property file="${basedir}/project.properties"/>
	
	<target name="main">
		<antcall target="banner"/>
		<antcall target="setupAefwUseDefaultProfile"/>
		<antcall target="setupAefwUseCustomProfile"/>
	</target>
	
	<target name="check">
		<condition property="rad.home" value="C:/Program Files/IBM/WebSphere/AppServer/profiles/AppSrv01/bin" else="C:/Program Files/IBM/SDP">
			<available file="C:/Program Files/IBM/WebSphere/AppServer/profiles/AppSrv01/bin" type="dir"/>
		</condition>
	</target>

	<target name="determineProfile">
		<condition property="custom.profile.used">
			<or>
				<equals arg1="${use.custom.profile}" arg2="true" casesensitive="no" />
				<equals arg1="${use.custom.profile}" arg2="yes" casesensitive="no" />
			</or>
		</condition>
	</target>
	
	<!-- ================================================================ -->
	<!-- B A N N E R                                                      -->
	<!-- ================================================================ -->

	<target name="banner" depends="check">
		<echo message=""/>
		<echo message="================================================= "/>
		<echo message=""/>
		<echo message="Installing AEFW on the server...                  "/>
		<echo message=""/>
		<echo message="================================================= "/>
		<echo message=""/>
		<echo message="ANT Version = ${ant.version}"/>
		<echo message="ANT File = ${ant.file}"/>
		<echo message="JVM = ${ant.java.version}"/>
		<echo message="java version = ${java.version}"/>
		<echo message="basedir = ${basedir}"/>
		<echo message="rad.home = ${rad.home}"/>
		<echo message="use.custom.profile = ${use.custom.profile}"/>
		<echo message="custom.profile.name = ${custom.profile.name}"/>
		<echo message=""/>
	</target>	


	<!-- ================================================================ -->
	<!-- S E T U P   C O R E  - U S I N G   D E F A U L T  P R O F I L E  -->
	<!-- ================================================================ -->

	<target name="setupAefwUseDefaultProfile" depends="check,determineProfile" unless="custom.profile.used">
		<echo message="Using Default Server Profile"/>
		<exec executable="${rad.home}/wsadmin.bat" failonerror="true">
			<arg value="-lang"/>
			<arg value="jython"/>
			<arg value="-profileName"/>
			<arg value="AppSrv06"/>
			<arg value="-f"/>
			<arg value="aefw-setup.jy"/>
		</exec>
	</target>
	
	<!-- ================================================================ -->
	<!-- S E T U P   C O R E  -  U S I N G  C U S T O M  P R O F I L E    -->
	<!-- ================================================================ -->

	<target name="setupAefwUseCustomProfile" depends="check,determineProfile" if="custom.profile.used">
		<echo message="Using Custom Server Profile - ${custom.profile.name}"/>
		<exec executable="${rad.home}/wsadmin.bat" failonerror="true">
			<arg value="-lang"/>
			<arg value="jython"/>
			<arg value="-f"/>
			<arg value="aefw-setup.jy"/>
		 	<arg value="-profileName"/>
			<arg value="${custom.profile.name}" />
		</exec>
	</target>

</project>
